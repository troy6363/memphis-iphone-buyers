<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memphis iPhone Buyers Inventory</title>
    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    <!-- Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- CSV Parser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div id="app">
        <!-- Sidebar -->
        <aside class="sidebar glass">
            <div class="logo">
                <img src="logo.png" alt="Memphis Buyers Logo" class="sidebar-logo-img">
            </div>
            <ul class="nav-links" id="monthNav">
                <!-- Generated by JS -->
            </ul>
            <div style="margin-top: auto; padding-top: 1rem;">
                <button id="logoutBtn" class="btn glass" onclick="triggerLogout()"
                    style="width: 100%; justify-content: start; color: #ef4444;">
                    <i class="ph-bold ph-sign-out"></i> Sign Out
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header>
                <div class="header-title-row">
                    <img src="logo.png" alt="Logo" class="mobile-header-logo">
                    <div>
                        <h1 id="pageTitle">Memphis iPhone Buyers Inventory</h1>
                        <p id="pageSubtitle" style="color: var(--text-muted); font-size: 0.9rem;">Track and analyze your
                            device inventory and revenue</p>
                    </div>
                </div>

                <div style="display: flex; gap: 1.5rem; align-items: center;">
                    <!-- Global Search -->
                    <div class="search-wrapper glass">
                        <i class="ph ph-magnifying-glass"></i>
                        <input type="text" id="globalSearch" placeholder="Search IMEI..." autocomplete="off">
                    </div>

                    <div id="dateDisplay" class="glass"
                        style="padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.9rem;"></div>
                </div>
            </header>

            <!-- Search Results View -->
            <div id="searchView" class="hidden animate-fade">
                <div style="margin-bottom: 2rem;">
                    <button class="btn glass" onclick="loadView('dashboard')"><i class="ph-bold ph-arrow-left"></i> Back
                        to Dashboard</button>
                </div>
                <h3>Search Results</h3>
                <p id="searchStats" style="color: var(--text-muted); margin-bottom: 2rem;"></p>

                <div class="glass table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Found In (Month)</th>
                                <th>Device Model</th>
                                <th>IMEI</th>
                                <th>Price</th>
                                <th>Invoice File</th>
                            </tr>
                        </thead>
                        <tbody id="searchResultsBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Dashboard View -->
            <div id="dashboardView" class="animate-fade">

                <!-- 1. Top Stats Row (4 Cards) -->
                <div class="stats-grid-4">
                    <!-- Devices -->
                    <div class="stat-card glass">
                        <div class="stat-icon box-blue"><i class="ph-fill ph-cube"></i></div>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <span class="stat-label">Total Devices</span>
                                <!-- Global Filter Moved Here -->
                                <select id="dashboardTimeFilter" class="glass-select" style="max-width: 100px;">
                                    <option value="year">All Year</option>
                                    <option value="January">Jan</option>
                                    <option value="February">Feb</option>
                                    <option value="March">Mar</option>
                                    <option value="April">Apr</option>
                                    <option value="May">May</option>
                                    <option value="June">Jun</option>
                                    <option value="July">Jul</option>
                                    <option value="August">Aug</option>
                                    <option value="September">Sep</option>
                                    <option value="October">Oct</option>
                                    <option value="November">Nov</option>
                                    <option value="December">Dec</option>
                                </select>
                            </div>
                            <div class="stat-value" id="dashTotalDevices">0</div>
                            <span class="stat-sub" id="dashDevicesSub">All-time</span>
                        </div>
                    </div>
                    <!-- Revenue -->
                    <div class="stat-card glass">
                        <div class="stat-icon box-green"><i class="ph-fill ph-currency-dollar"></i></div>
                        <div>
                            <span class="stat-label">Total Revenue</span>
                            <div class="stat-value" id="dashTotalRevenue">$0.00</div>
                            <span class="stat-sub">All-time earnings</span>
                        </div>
                    </div>
                    <!-- Avg Price -->
                    <div class="stat-card glass">
                        <div class="stat-icon box-orange"><i class="ph-fill ph-trend-up"></i></div>
                        <div>
                            <span class="stat-label">Avg Price/Device</span>
                            <div class="stat-value" id="dashAvgPrice">$0.00</div>
                            <span class="stat-sub">Per unit average</span>
                        </div>
                    </div>
                    <!-- Invoices -->
                    <div class="stat-card glass">
                        <div class="stat-icon box-purple"><i class="ph-fill ph-files"></i></div>
                        <div>
                            <span class="stat-label">Total Invoices</span>
                            <div class="stat-value" id="dashTotalInvoices">0</div>
                            <span class="stat-sub">Invoice entries</span>
                        </div>
                    </div>
                </div>

                <!-- 2. Middle Split Section -->
                <div class="grid-split-2">
                    <!-- Chart -->
                    <div class="glass card-panel">
                        <h3>Monthly Revenue Trend</h3>
                        <div style="height: 250px; margin-top: 1rem;">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                    <!-- Top Devices -->
                    <div class="glass card-panel">
                        <h3>Top Devices by Revenue</h3>
                        <div class="top-devices-list" id="topDevicesList">
                            <!-- Populated by JS -->
                            <div class="empty-state">No data available</div>
                        </div>
                    </div>
                </div>

                <!-- 3. Recent Invoices / CTA -->
                <div class="glass card-panel" style="margin-top: 2rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3>Quick Actions</h3>
                        <!-- Initial Upload CTA -->
                        <button class="btn btn-primary" id="dashUploadBtn">
                            <i class="ph-bold ph-plus"></i> Add Invoice
                        </button>
                    </div>
                    <div id="dashboardRecentList">
                        <!-- Populated by JS -->
                    </div>
                </div>

            </div>

            <!-- Month Detail View (Hidden by default) -->
            <div id="monthView" class="hidden animate-fade">
                <div style="margin-bottom: 2rem;">
                    <button class="btn glass" onclick="loadView('dashboard')"><i class="ph-bold ph-arrow-left"></i> Back
                        to Dashboard</button>
                </div>

                <div class="stats-grid-4">
                    <div class="stat-card glass">
                        <div class="stat-icon box-blue"><i class="ph-fill ph-cube"></i></div>
                        <div>
                            <span class="stat-label">Devices</span>
                            <div class="stat-value" id="monthDevices">0</div>
                        </div>
                    </div>
                    <div class="stat-card glass">
                        <div class="stat-icon box-green"><i class="ph-fill ph-currency-dollar"></i></div>
                        <div>
                            <span class="stat-label">Total Paid</span>
                            <div class="stat-value" id="monthSpend">$0.00</div>
                        </div>
                    </div>
                </div>

                <div class="upload-zone glass" id="dropZone" style="margin-top: 2rem;">
                    <i class="ph ph-upload-simple" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                    <h3>Drop CSV Invoice Here</h3>
                    <p>or click to browse files</p>
                    <input type="file" id="fileInput" accept=".csv" style="display: none;">
                </div>

                <div class="glass table-container" style="margin-top: 2rem;">
                    <div
                        style="padding: 1rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between;">
                        <h3>Uploaded Invoices</h3>
                        <button class="btn btn-danger" id="clearMonthBtn">Clear Month</button>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>File</th>
                                <th>Devices</th>
                                <th>Total</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="invoicesTableBody"></tbody>
                    </table>
                </div>

                <div class="glass table-container" style="margin-top: 2rem;">
                    <div style="padding: 1rem; border-bottom: 1px solid var(--border);">
                        <h3>Item Breakdown</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Device / Item</th>
                                <th>Date</th>
                                <th>IMEI</th>
                                <th>Qty</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody id="itemsTableBody"></tbody>
                    </table>
                </div>
            </div>

        </main>
        </main>
    </div>

    <!-- Login View (Overlay) -->
    <div id="loginView" class="hidden">
        <div class="login-card glass">
            <img src="logo.png" alt="Logo" style="width: 80px; margin-bottom: 1rem;">
            <h2>Welcome Back</h2>
            <p style="color: var(--text-muted); margin-bottom: 2rem;">Sign in to manage your inventory</p>
            <button id="loginBtn" class="btn btn-primary" onclick="triggerLogin()"
                style="width: 100%; justify-content: center; padding: 1rem;">
                <i class="ph-bold ph-google-logo"></i> Sign in with Google
            </button>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>

</html>